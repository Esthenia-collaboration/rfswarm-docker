# "docker compose up -d --build" or "docker compose --profile sshlibrary up -d --build" for ssh agent
services:

  agent:
    build:
      context: .
      dockerfile: agent/${AGENT_FOLDER:-base}/Dockerfile
    hostname: ${AGENT_FOLDER:-base}_agent
    security_opt:
      - no-new-privileges:true
    user: rfagent
    networks:
      - rfswarm
    depends_on:
      - manager
    environment:
      AGENTNAME: ${AGENT_FOLDER:-base}
      PROPERTY1: PROPERTY1
      PROPERTY2: PROPERTY2
      MANAGER: http://manager:${MANAGER_PORT:-8138} # URL to contact the manager. the value "manager" in the URL is the name of manager's docker container. It can only be use if the manager and agent are on the same network. Otherwise, network address must to be use.
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "10"
    container_name: ${AGENT_FOLDER:-base}

  ssh_server:
    profiles:
      - sshlibrary
    build:
      context: .
      dockerfile: ssh-server/Dockerfile
    hostname: ssh_server
    security_opt:
      - no-new-privileges:true
    networks:
      - rfswarm
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "10"
    container_name: ssh_server

include:
  - manager/compose-manager.yml
